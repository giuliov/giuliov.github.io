<!doctype html><html lang=en><meta charset=utf-8><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/blog.casavian.eu\/"},"articleSection":"post","name":"Automating TeamProject creation (Git included)","headline":"Automating TeamProject creation (Git included)","description":"Notes and considerations of small venetian guy on DevOps tools, architecture, development and other paraphernalia.","inLanguage":"en","author":"Giulio Vian","creator":"Giulio Vian","publisher":"Giulio Vian","accountablePerson":"Giulio Vian","copyrightHolder":"Giulio Vian","copyrightYear":"2014","datePublished":"2014-10-28T00:00:00Z","dateModified":"2014-10-28T00:00:00Z","url":"\/2014\/10\/28\/automating-project-creation\/","wordCount":"590","keywords":["TFS 2013","TFS Administration","TeamProject","Git","PowerShell","Blog"]}</script><title>Automating TeamProject creation (Git included) &ndash; Giulio Vian's Blog!</title><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=description content="Notes and considerations of small venetian guy on DevOps tools, architecture, development and other paraphernalia."><meta name=author content="Giulio Vian"><link rel=icon href=/favicon.ico><meta itemprop=name content="Automating TeamProject creation (Git included)"><meta itemprop=description content="I get frequent request from my teams to create a new project, therefore I automated the task with a PowerShell script.
PowerShell Creation scripts The script algorithm goes like this:
 Load the definition for the new project Validate the definition by  checking the user accounts invoke the creation tool with the /validate option   Creates the project using TFPT &nbsp;  Creates an Organizational Unit in Active Directory where placing the groups Creates the AD groups and add the user account Creates corresponding TFS groups Checks that user account belongs to one of the three AD groups that control the TFS Access Level — best known as Licensing  I will spare you the code here as it is more than 100 lines long."><meta itemprop=datePublished content="2014-10-28T00:00:00+00:00"><meta itemprop=dateModified content="2014-10-28T00:00:00+00:00"><meta itemprop=wordCount content="590"><meta itemprop=keywords content="TFS 2013,TFS Administration,TeamProject,Git,PowerShell,"><meta property="og:title" content="Automating TeamProject creation (Git included)"><meta property="og:description" content="I get frequent request from my teams to create a new project, therefore I automated the task with a PowerShell script.
PowerShell Creation scripts The script algorithm goes like this:
 Load the definition for the new project Validate the definition by  checking the user accounts invoke the creation tool with the /validate option   Creates the project using TFPT &nbsp;  Creates an Organizational Unit in Active Directory where placing the groups Creates the AD groups and add the user account Creates corresponding TFS groups Checks that user account belongs to one of the three AD groups that control the TFS Access Level — best known as Licensing  I will spare you the code here as it is more than 100 lines long."><meta property="og:type" content="article"><meta property="og:url" content="http://blog.casavian.eu/2014/10/28/automating-project-creation/"><meta property="article:published_time" content="2014-10-28T00:00:00+00:00"><meta property="article:modified_time" content="2014-10-28T00:00:00+00:00"><meta property="og:site_name" content="Giulio Vian's Blog!"><meta name=twitter:card content="summary"><meta name=twitter:title content="Automating TeamProject creation (Git included)"><meta name=twitter:description content="I get frequent request from my teams to create a new project, therefore I automated the task with a PowerShell script.
PowerShell Creation scripts The script algorithm goes like this:
 Load the definition for the new project Validate the definition by  checking the user accounts invoke the creation tool with the /validate option   Creates the project using TFPT &nbsp;  Creates an Organizational Unit in Active Directory where placing the groups Creates the AD groups and add the user account Creates corresponding TFS groups Checks that user account belongs to one of the three AD groups that control the TFS Access Level — best known as Licensing  I will spare you the code here as it is more than 100 lines long."><meta name=twitter:site content="@giulio_vian"><link rel=alternate href=/index.xml type=application/rss+xml title="Giulio Vian's Blog!"><link rel=stylesheet href=/css/vendor.min.95b0b4c4607aec507f0fc9d9c36a12a4613ccac06f9423caa43e265cb58eb5f90709388cc0fa166ac3ca836b4163e6d0569b8b86065d9cabdf223c5ea9a63b08.css integrity="sha512-lbC0xGB67FB/D8nZw2oSpGE8ysBvlCPKpD4mXLWOtfkHCTiMwPoWasPKg2tBY+bQVpuLhgZdnKvfIjxeqaY7CA=="><link href=http://blog.casavian.eu/css/cookieconsent.min.cd0d0b6e50ff01ff2f3a9a70d7cfb66a7c6cb9acf7a566325568be6d3bd31fc4.css rel=stylesheet type=text/css integrity="sha256-zQ0LblD/Af8vOppw18+2anxsuaz3pWYyVWi+bTvTH8Q=" crossorigin=anonymous><script src=http://blog.casavian.eu/js/cookieconsent.min.e55842a856a6d829feca3c3ad736c136b6c7549e9247274f78aa296259e06e24.js integrity="sha256-5VhCqFam2Cn+yjw61zbBNrbHVJ6SRydPeKopYlngbiQ=" crossorigin=anonymous async></script><script>window.addEventListener("load",function(){window.cookieconsent.initialise({"palette":{"popup":{"background":"#428bca","text":"#ffffff"},"button":{"background":"#f71559"}},"content":{"message":'This website uses cookies.',"dismiss":'Got it!',"link":'Learn more.',"href":"http:\/\/blog.casavian.eu\/page\/privacy-cookies-policy\/"},"position":"bottom-right"})});</script><body><nav class="navbar navbar-light bg-white navbar-expand-lg border-bottom"><div class=container><a class="navbar-brand text-primary" href=/>Giulio Vian's Blog!</a>
<button class="navbar-toggler collapsed" type=button data-toggle=collapse data-target=#navbarCollapse aria-controls=navbarCollapse aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="navbar-collapse collapse" id=navbarCollapse><ul class="navbar-nav mr-auto"><li class=nav-item><a class="nav-link text-primary" href=/index.html><i class="fas fa-home"></i>Home</a></li><li class=nav-item><a class="nav-link text-primary" href=/page/about/><i class="fa fa-info-circle"></i>About</a></li><li class=nav-item><a class="nav-link text-primary" href=/page/public-speaking><i class="fa fa-microphone"></i>Speaking</a></li><li class=nav-item><a class="nav-link text-primary" href=/it><i class="fa fa-language"></i>Italian</a></li></ul></div></div></nav><main role=main><div class="container mt-3 mb-3"><div class=card><div class=card-body><h1 class=card-title><a href=/2014/10/28/automating-project-creation/>Automating TeamProject creation (Git included)</a></h1><h6 class="card-subtitle mb-2 text-muted"><i class="fas fa-calendar-day"></i>&nbsp;28 Oct 2014 -
<i class="fas fa-user"></i>&nbsp;Giulio Vian
- <i class="fas fa-clock"></i>&nbsp;~3 Minutes</h6><p class=card-text><p>I get frequent request from my teams to create a new project, therefore I automated the task with a PowerShell script.</p><h2 id=powershell-creation-scripts>PowerShell Creation scripts</h2><p>The script algorithm goes like this:</p><ol><li>Load the definition for the new project</li><li>Validate the definition by<ul><li>checking the user accounts</li><li>invoke the creation tool with the <code>/validate</code> option</li></ul></li><li>Creates the project using <a href=https://visualstudiogallery.msdn.microsoft.com/f017b10c-02b4-4d6d-9845-58a06545627f target=_blank rel="noopener noreferrer">TFPT
&nbsp;<i class="fas fa-external-link-alt"></i></a></li><li>Creates an Organizational Unit in Active Directory where placing the groups</li><li>Creates the AD groups and add the user account</li><li>Creates corresponding TFS groups</li><li>Checks that user account belongs to one of the three AD groups that control the TFS Access Level — best known as Licensing</li></ol><p>I will spare you the code here as it is more than 100 lines long. If interested download the <a href=Automating_TeamProject_creation.zip>Zip file
</a>: <code>New-TeamProject.ps1</code> is the workhorse that execute the above algorithm, <code>NewTeamProjectRequest.ps1</code> contains the definition of the project to create and is included in the former.</p><p>The script can be run multiple times, it outputs annoying error messages for existing objects.
A nice side-effect of this approach is keeping the history of projects by archiving the definition files.</p><p><code>Sync-TfsIdentity.ps1</code> is another script that starts immediately the TFS Job that synchronize TFS identities with Active Directory.</p><h3 id=why-active-directory-groups>Why Active Directory groups?</h3><p>The policy to control project access via Active Directory groups has two facets. On one side it is easier to synchronize permission on Reporting Services and SharePoint. On the other hand, any person in IT can administer Active Directory groups, given the permission on the TFS Organizational Unit; they need no specific knowledge of TFS.</p><h2 id=git-in-view>Git in view</h2><p>The PowerShell script was fine until my people started asking for Git in their new projects. I discovered that <a href=https://visualstudiogallery.msdn.microsoft.com/f017b10c-02b4-4d6d-9845-58a06545627f target=_blank rel="noopener noreferrer">TFPT
&nbsp;<i class="fas fa-external-link-alt"></i></a> has no support for it. How dear, back to manual work? Looking at this <a href=http://stackoverflow.com/questions/25059652/automate-git-repository-creation-on-tfs-2013/25158099#25158099 target=_blank rel="noopener noreferrer">StackOverflow question
&nbsp;<i class="fas fa-external-link-alt"></i>
</a>, the problem seems to have a solution.
So, I take the bull by the horn, waded through TFS APIs and found the nice <code>GitRepositoryService</code> class and its <code>CreateTeamProjectRepository</code> method which seems to perfectly fir the bill, but what is that <code>AccessControlEntries</code> parameter?</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>var</span> gitSvc = tpc.GetService&lt;Microsoft.TeamFoundation.Git.Client.GitRepositoryService&gt;();
gitSvc.CreateTeamProjectRepository(teamProject, ACEs);
</code></pre></div><p>Well, it is the list of permissions for the newly created Git Repository. TFS normally associates 7 groups, each one has a different set of permissions. It ends up that just building the list of ACEs requires more than 70 (boring) lines of code.
I assembled a quick utility <strong>TfsGitAdmin</strong> that wraps this code and allows you to add the default Git repository to a Project with <strong>no</strong> version control, or add an additional Git repository.</p><p>Usage is simple:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bat data-lang=bat>TfsGitAdmin &lt;TFS_url&gt; &lt;TeamCollectionName&gt; &lt;TeamProjectName&gt; [&lt;GitRepositoryName&gt;]
</code></pre></div><p>When invoked with three arguments, is tries to add the default Git repository to a Project without version control; if you add the fourth parameter, it tries to add a Repository with the specified name, to a project with Git version control.</p><h3 id=projects-with-tfvc>Projects with TFVC?</h3><p>As expected, if you try to add a Git repository to project with classic TFS Version Control (TFVC), you receive this error</p><blockquote><p>TF401024: A Git repository for the team project &lsquo;TFVC Scrum&rsquo; could not be created because another source control system is enabled for that team project.</p></blockquote><p>If you think, like me, that this is an important feature, go to UserVoice and vote for <a href=http://visualstudio.uservoice.com/forums/121579-visual-studio/suggestions/5367806-allow-multiple-git-or-tfvc-repositories-in-a-singl target=_blank rel="noopener noreferrer">Mr.Hinsh&rsquo;s proposal
&nbsp;<i class="fas fa-external-link-alt"></i>
</a>.</p><h2 id=finale>Finale</h2><p>Ths source code, for both the script and the utility, can be downloaded from <a href=Automating_TeamProject_creation.zip>here
</a>.</p><p>I hope that the <a href=https://visualstudiogallery.msdn.microsoft.com/f017b10c-02b4-4d6d-9845-58a06545627f target=_blank rel="noopener noreferrer">Team Foundation Power Tools
&nbsp;<i class="fas fa-external-link-alt"></i></a> will be extended to include this feature, but in the meantime you can use my little tools.</p></p></div><div class=card-footer><small class=text-muted><i class="fas fa-folder text-primary"></i>&nbsp;
<a href=/categories/#alm class="badge badge-primary"><span>ALM</span></a><br><i class="fas fa-tags text-secondary"></i>&nbsp;
<a href=/tags/#tfs-2013 class="badge badge-secondary"><span>TFS 2013</span></a>
<a href=/tags/#tfs-administration class="badge badge-secondary"><span>TFS Administration</span></a>
<a href=/tags/#teamproject class="badge badge-secondary"><span>TeamProject</span></a>
<a href=/tags/#git class="badge badge-secondary"><span>Git</span></a>
<a href=/tags/#powershell class="badge badge-secondary"><span>PowerShell</span></a></small></div></div><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"blog-casavian"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></main><footer class="navbar-light border-top"><div class=container><div class=row><div class="col-12 col-md-3 mb-3"><h5>Giulio Vian's Blog!</h5>Notes and considerations of small venetian guy on DevOps tools, architecture, development and other paraphernalia.</div><div class="col-12 col-md-3 mb-3"><h5>Social</h5><ul class="list-unstyled list-inline"><li class=list-inline-item><a href=https://github.com/giuliov target=_blank rel="noopener noreferrer" title=GitHub class="fab fa-github fa-2x"></a></li><li class=list-inline-item><a href=https://stackoverflow.com/users/100864 target=_blank rel="noopener noreferrer" title="Stack Overflow" class="fab fa-stack-overflow fa-2x"></a></li><li class=list-inline-item><a href=https://medium.com/@giuliovdev target=_blank rel="noopener noreferrer" title=Medium class="fab fa-medium fa-2x"></a></li><li class=list-inline-item><a href=https://linkedin.com/in/giuliovian target=_blank rel="noopener noreferrer" title=LinkedIn class="fab fa-linkedin fa-2x"></a></li><li class=list-inline-item><a href=https://linkedin.com/company/unum-ireland-ltd-it target=_blank rel="noopener noreferrer" title="LinkedIn Company" class="fab fa-linkedin fa-2x"></a></li><li class=list-inline-item><a href=https://xing.com/profile/Giulio_Vian target=_blank rel="noopener noreferrer" title=Xing class="fab fa-xing fa-2x"></a></li><li class=list-inline-item><a href=https://slideshare.net/giuliov target=_blank rel="noopener noreferrer" title=SlideShare class="fab fa-slideshare fa-2x"></a></li><li class=list-inline-item><a href=https://youtube.com/UCZ-J6JRyvz6aaJ9zCN5wpxA target=_blank rel="noopener noreferrer" title=YouTube class="fab fa-youtube fa-2x"></a></li><li class=list-inline-item><a href=https://twitter.com/giulio_vian target=_blank rel="noopener noreferrer" title=Twitter class="fab fa-twitter fa-2x"></a></li><li class=list-inline-item><a href=mailto:giulio.dev@casavian.eu title=Email class="fas fa-envelope fa-2x"></a></li></ul></div><div class="col-12 col-md-3 mb-3"><h5>Site</h5><ul class=list-unstyled><li><a href=/about/><i class="fas fa-address-card"></i>About</a></li><li><a href=/categories/><i class="fas fa-folder"></i>Categories</a></li><li><a href=/series/><i class="fas fa-book"></i>Series</a></li><li><a href=/tags/><i class="fas fa-tags"></i>Tags</a></li><li><a href=http://www.getlatestversion.eu/>Get Latest Version</a></li><li><a href=https://blogs.msdn.microsoft.com/giuliov/>Old blog</a></li></ul></div><div class="col-12 col-md-3 mb-3">&copy; 2020 Giulio Vian<br>Theme by <a href=https://www.spech.de target=_blank rel="noopener noreferrer">Sebastian Pech</a>.</div></div></div></footer><script src=/js/vendor.min.0497fa926ed3dc2241b91e016467480841da9749a0f7c40ed3960c3c238745e5accb5ec5e07654668e11047bbf96f95083b88dd49a845781011aba42e4f00a5d.js integrity="sha512-BJf6km7T3CJBuR4BZGdICEHal0mg98QO05YMPCOHReWsy17F4HZUZo4RBHu/lvlQg7iN1JqEV4EBGrpC5PAKXQ=="></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-46796059-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>