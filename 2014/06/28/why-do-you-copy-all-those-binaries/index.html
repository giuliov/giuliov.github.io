<!doctype html><html lang=en><meta charset=utf-8><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/blog.casavian.eu\/"},"articleSection":"post","name":"Why do you copy all those binaries?","headline":"Why do you copy all those binaries?","description":"Notes and considerations of small venetian guy on DevOps tools, architecture, development and other paraphernalia.","inLanguage":"en","author":"Giulio Vian","creator":"Giulio Vian","publisher":"Giulio Vian","accountablePerson":"Giulio Vian","copyrightHolder":"Giulio Vian","copyrightYear":"2014","datePublished":"2014-06-28T00:00:00Z","dateModified":"2014-06-28T00:00:00Z","url":"\/2014\/06\/28\/why-do-you-copy-all-those-binaries\/","wordCount":"567","keywords":["Build","Drop","Blog"]}</script><title>Why do you copy all those binaries? &ndash; Giulio Vian's Blog!</title><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=description content="Notes and considerations of small venetian guy on DevOps tools, architecture, development and other paraphernalia."><meta name=author content="Giulio Vian"><link rel=icon href=/favicon.ico><meta itemprop=name content="Why do you copy all those binaries?"><meta itemprop=description content="Some days ago I replied to StackOverflow question &ldquo;TFS 2010 Build, constant drop location, random access issue &nbsp; &#34;, and it reminded of an approach used in the past that revealed being effective.
The scenario TFS Build creates a new folder in the Drop share at each new Build, no matter if it was successful or completely failed. The folder name is taken from the build identifier generated during the build run, e."><meta itemprop=datePublished content="2014-06-28T00:00:00+00:00"><meta itemprop=dateModified content="2014-06-28T00:00:00+00:00"><meta itemprop=wordCount content="567"><meta itemprop=keywords content="Build,Drop,"><meta property="og:title" content="Why do you copy all those binaries?"><meta property="og:description" content="Some days ago I replied to StackOverflow question &ldquo;TFS 2010 Build, constant drop location, random access issue &nbsp; &#34;, and it reminded of an approach used in the past that revealed being effective.
The scenario TFS Build creates a new folder in the Drop share at each new Build, no matter if it was successful or completely failed. The folder name is taken from the build identifier generated during the build run, e."><meta property="og:type" content="article"><meta property="og:url" content="http://blog.casavian.eu/2014/06/28/why-do-you-copy-all-those-binaries/"><meta property="article:published_time" content="2014-06-28T00:00:00+00:00"><meta property="article:modified_time" content="2014-06-28T00:00:00+00:00"><meta property="og:site_name" content="Giulio Vian's Blog!"><meta name=twitter:card content="summary"><meta name=twitter:title content="Why do you copy all those binaries?"><meta name=twitter:description content="Some days ago I replied to StackOverflow question &ldquo;TFS 2010 Build, constant drop location, random access issue &nbsp; &#34;, and it reminded of an approach used in the past that revealed being effective.
The scenario TFS Build creates a new folder in the Drop share at each new Build, no matter if it was successful or completely failed. The folder name is taken from the build identifier generated during the build run, e."><meta name=twitter:site content="@giulio_vian"><link rel=alternate href=/index.xml type=application/rss+xml title="Giulio Vian's Blog!"><link rel=stylesheet href=/css/vendor.min.95b0b4c4607aec507f0fc9d9c36a12a4613ccac06f9423caa43e265cb58eb5f90709388cc0fa166ac3ca836b4163e6d0569b8b86065d9cabdf223c5ea9a63b08.css integrity="sha512-lbC0xGB67FB/D8nZw2oSpGE8ysBvlCPKpD4mXLWOtfkHCTiMwPoWasPKg2tBY+bQVpuLhgZdnKvfIjxeqaY7CA=="><link href=http://blog.casavian.eu/css/cookieconsent.min.cd0d0b6e50ff01ff2f3a9a70d7cfb66a7c6cb9acf7a566325568be6d3bd31fc4.css rel=stylesheet type=text/css integrity="sha256-zQ0LblD/Af8vOppw18+2anxsuaz3pWYyVWi+bTvTH8Q=" crossorigin=anonymous><script src=http://blog.casavian.eu/js/cookieconsent.min.e55842a856a6d829feca3c3ad736c136b6c7549e9247274f78aa296259e06e24.js integrity="sha256-5VhCqFam2Cn+yjw61zbBNrbHVJ6SRydPeKopYlngbiQ=" crossorigin=anonymous async></script><script>window.addEventListener("load",function(){window.cookieconsent.initialise({"palette":{"popup":{"background":"#428bca","text":"#ffffff"},"button":{"background":"#f71559"}},"content":{"message":'This website uses cookies.',"dismiss":'Got it!',"link":'Learn more.',"href":"http:\/\/blog.casavian.eu\/page\/privacy-cookies-policy\/"},"position":"bottom-right"})});</script><body><nav class="navbar navbar-light bg-white navbar-expand-lg border-bottom"><div class=container><a class="navbar-brand text-primary" href=/>Giulio Vian's Blog!</a>
<button class="navbar-toggler collapsed" type=button data-toggle=collapse data-target=#navbarCollapse aria-controls=navbarCollapse aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="navbar-collapse collapse" id=navbarCollapse><ul class="navbar-nav mr-auto"><li class=nav-item><a class="nav-link text-primary" href=/index.html><i class="fas fa-home"></i>Home</a></li><li class=nav-item><a class="nav-link text-primary" href=/page/about/><i class="fa fa-info-circle"></i>About</a></li><li class=nav-item><a class="nav-link text-primary" href=/page/public-speaking><i class="fa fa-microphone"></i>Speaking</a></li></ul></div></div></nav><main role=main><div class="container mt-3 mb-3"><div class=card><div class=card-body><h1 class=card-title><a href=/2014/06/28/why-do-you-copy-all-those-binaries/>Why do you copy all those binaries?</a></h1><h6 class="card-subtitle mb-2 text-muted"><i class="fas fa-calendar-day"></i>&nbsp;28 Jun 2014 -
<i class="fas fa-user"></i>&nbsp;Giulio Vian
- <i class="fas fa-clock"></i>&nbsp;~3 Minutes</h6><p class=card-text><p>Some days ago I replied to StackOverflow question &ldquo;<a href=http://stackoverflow.com/questions/23991455/tfs-2010-build-constant-drop-location-random-access-issue target=_blank rel="noopener noreferrer">
TFS 2010 Build, constant drop location, random access issue
&nbsp;<i class="fas fa-external-link-alt"></i>
</a>", and it reminded of an approach used in the past that revealed being effective.</p><h4 id=the-scenario>The scenario</h4><p>TFS Build creates a new folder in the Drop share at each new Build, no matter if it was successful or completely failed. The folder name is taken from the build identifier generated during the build run, e.g. MyBuild_14102.3.</p><p>This is good to keep all the recent builds, but it has the drawback that the path to a build that you want to deploy is variable.</p><p>A common solution pattern is to customize the Build Template and add a final step to copy the artefacts to a know location. In TFS 2013 could be a one-line batch file.</p><pre><code>    robocopy &quot;%TF_BUILD_DROPLOCATION%&quot; &quot;%TF_BUILD_DROPLOCATION%\..\MyBuild_LastGreen&quot; /E
</code></pre><p>Simple, but inconvenient, as it waste disk space and lengthen build time. Much worse it overlaps the old content, and it is hard knowing which build was copied into.</p><p><strong>Important note</strong>: all this happens only when the Drop location is a network share.</p><p>The solution is to have a pointer, a reference to the last green build.</p><h4 id=local-solution>Local solution</h4><p>The simplest case happens when you have both the Build Agent and the Drop folder on the same machine. In this case you create a <a href=http://msdn.microsoft.com/en-us/library/windows/desktop/aa365006.aspx target=_blank rel="noopener noreferrer">directory junction
&nbsp;<i class="fas fa-external-link-alt"></i></a> with the mklink command.</p><pre><code>    mklink /J D:\Drops\MyBuild_LastGreen D:\Drops\MyBuild\MyBuild_14102.3
</code></pre><p>rmdir is the command that remove the junction.</p><pre><code>    rmdir D:\Drops\MyBuild_LastGreen
</code></pre><p>Junctions are nicely processed at the server, that is to the client requesting \\BuildServer\Drops\MyBuild_LastGreen is completely transparent.</p><h4 id=remote-solution>Remote solution</h4><p>Assume now, that the Drop folder lives on another Windows machine different from the Build server.</p><p>One option is to use the same technique above, i.e. creating a directory junction, this time through a remote call.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Powershell data-lang=Powershell>    Invoke-Command -ComputerName MYFILESERVER -ScriptBlock { mklink /J <span style=color:#e6db74>&#34;G:\Drops\MyBuild_LastGreen&#34;</span> <span style=color:#e6db74>&#34;G:\Drops\MyBuild\MyBuild_14102.3&#34;</span> }
</code></pre></div><p>Consider that the account running the Build Agent must have adequate permissions on the target machine.</p><p>An alternative is to create a new network share pointing to the desired folder. Powershell (again) makes this easy, even if the disk is remote.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Powershell data-lang=Powershell>    $cs = New-CimSession <span style=color:#960050;background-color:#1e0010>–</span>ComputerName <span style=color:#e6db74>&#34;MYFILESERVER&#34;</span>
    New-SmbShare <span style=color:#960050;background-color:#1e0010>–</span>Name <span style=color:#e6db74>&#34;MyBuild_LastGreen&#34;</span> <span style=color:#960050;background-color:#1e0010>–</span>Path <span style=color:#e6db74>&#34;G:\Drops\MyBuild\MyBuild_14102.3&#34;</span> -CimSession $cs
</code></pre></div><p>If you have PowerShell 2.0 this will not work, but you can use the good tutorial at <a href=http://windowsitpro.com/powershell/managing-file-shares-windows-powershell target=_blank rel="noopener noreferrer">Managing File Shares with Windows PowerShell
&nbsp;<i class="fas fa-external-link-alt"></i>
</a>; as an alternative, you may use wmic (see <a href=http://support.microsoft.com/kb/295622 target=_blank rel="noopener noreferrer">KB295622 - How to Create a Share Remotely By Using the Windows Management Instrumentation Command-Line Tool
&nbsp;<i class="fas fa-external-link-alt"></i>
</a>).</p><p>The most complex case is a Drop folder living on some storage you cannot act upon, for example a Linux NAS. This situation has no easy solution, so I limit hinting some directions. One option is to mount the storage on a Windows machine where you apply the technique above. If you are confident with *nix command like mount, chmod and bash script, you may use <a href=http://tfsbuildextensions.codeplex.com/ target=_blank rel="noopener noreferrer">Community TFS Build Extensions
&nbsp;<i class="fas fa-external-link-alt"></i></a> to ssh in the remote machine, like I exemplified in <a href=/2014/02/13/integrating-linux-builds-in-tfs/>Integrating Linux builds in TFS
</a>.</p><h4 id=conclusions>Conclusions</h4><p>I like much the approach of using file system links instead of copying files. It is more efficient, self-descriptive and you reach the goal of fixed names for important folders.</p><p>One can be interested in marking interesting build setting the Build Quality property and automatically creating the corresponding link leveraging a tool like <a href=https://tfsdeployer.codeplex.com/ target=_blank rel="noopener noreferrer">TFS Deployer
&nbsp;<i class="fas fa-external-link-alt"></i></a> or DYI like my friend Pieter shows in <a href=http://intovsts.net/2012/02/12/managing-builds-through-the-build-quality-value/ target=_blank rel="noopener noreferrer">his post
&nbsp;<i class="fas fa-external-link-alt"></i>
</a>.</p></p></div><div class=card-footer><small class=text-muted><i class="fas fa-folder text-primary"></i>&nbsp;
<a href=/categories/#alm class="badge badge-primary"><span>ALM</span></a><br><i class="fas fa-tags text-secondary"></i>&nbsp;
<a href=/tags/#build class="badge badge-secondary"><span>Build</span></a>
<a href=/tags/#drop class="badge badge-secondary"><span>Drop</span></a></small></div></div></div></main><footer class="navbar-light border-top"><div class=container><div class=row><div class="col-12 col-md-3 mb-3"><h5>Giulio Vian's Blog!</h5>Notes and considerations of small venetian guy on DevOps tools, architecture, development and other paraphernalia.</div><div class="col-12 col-md-3 mb-3"><h5>Social</h5><ul class="list-unstyled list-inline"><li class=list-inline-item><a href=https://github.com/giuliov target=_blank rel="noopener noreferrer" title=GitHub class="fab fa-github fa-2x"></a></li><li class=list-inline-item><a href=https://stackoverflow.com/users/100864 target=_blank rel="noopener noreferrer" title="Stack Overflow" class="fab fa-stack-overflow fa-2x"></a></li><li class=list-inline-item><a href=https://medium.com/@giuliovdev target=_blank rel="noopener noreferrer" title=Medium class="fab fa-medium fa-2x"></a></li><li class=list-inline-item><a href=https://linkedin.com/in/giuliovian target=_blank rel="noopener noreferrer" title=LinkedIn class="fab fa-linkedin fa-2x"></a></li><li class=list-inline-item><a href=https://linkedin.com/company/unum-ireland-ltd-it target=_blank rel="noopener noreferrer" title="LinkedIn Company" class="fab fa-linkedin fa-2x"></a></li><li class=list-inline-item><a href=https://xing.com/profile/Giulio_Vian target=_blank rel="noopener noreferrer" title=Xing class="fab fa-xing fa-2x"></a></li><li class=list-inline-item><a href=https://slideshare.net/giuliov target=_blank rel="noopener noreferrer" title=SlideShare class="fab fa-slideshare fa-2x"></a></li><li class=list-inline-item><a href=https://youtube.com/UCZ-J6JRyvz6aaJ9zCN5wpxA target=_blank rel="noopener noreferrer" title=YouTube class="fab fa-youtube fa-2x"></a></li><li class=list-inline-item><a href=https://twitter.com/giulio_vian target=_blank rel="noopener noreferrer" title=Twitter class="fab fa-twitter fa-2x"></a></li><li class=list-inline-item><a href=mailto:giulio.dev@casavian.eu title=Email class="fas fa-envelope fa-2x"></a></li></ul></div><div class="col-12 col-md-3 mb-3"><h5>Site</h5><ul class=list-unstyled><li><a href=/about/><i class="fas fa-address-card"></i>About</a></li><li><a href=/categories/><i class="fas fa-folder"></i>Categories</a></li><li><a href=/series/><i class="fas fa-book"></i>Series</a></li><li><a href=/tags/><i class="fas fa-tags"></i>Tags</a></li></ul></div><div class="col-12 col-md-3 mb-3">&copy; 2020 Giulio Vian<br>Theme by <a href=https://www.spech.de target=_blank rel="noopener noreferrer">Sebastian Pech</a>.</div></div></div></footer><script src=/js/vendor.min.0497fa926ed3dc2241b91e016467480841da9749a0f7c40ed3960c3c238745e5accb5ec5e07654668e11047bbf96f95083b88dd49a845781011aba42e4f00a5d.js integrity="sha512-BJf6km7T3CJBuR4BZGdICEHal0mg98QO05YMPCOHReWsy17F4HZUZo4RBHu/lvlQg7iN1JqEV4EBGrpC5PAKXQ=="></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-46796059-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>