<!doctype html><html lang=en><meta charset=utf-8><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/blog.casavian.eu\/"},"articleSection":"post","name":"TFS in PowerShell","headline":"TFS in PowerShell","description":"Notes and considerations of small venetian guy on DevOps tools, architecture, development and other paraphernalia.","inLanguage":"en","author":"Giulio Vian","creator":"Giulio Vian","publisher":"Giulio Vian","accountablePerson":"Giulio Vian","copyrightHolder":"Giulio Vian","copyrightYear":"2014","datePublished":"2014-09-19T17:07:59Z","dateModified":"2014-09-19T17:07:59Z","url":"\/2014\/09\/19\/tfs-in-powershell\/","wordCount":"468","keywords":["TFS","Powershell","TFS Administration","Blog"]}</script><title>TFS in PowerShell &ndash; Giulio Vian's Blog!</title><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=description content="Notes and considerations of small venetian guy on DevOps tools, architecture, development and other paraphernalia."><meta name=author content="Giulio Vian"><link rel=icon href=/favicon.ico><meta itemprop=name content="TFS in PowerShell"><meta itemprop=description content="I am re-factoring my PowerShell administration scripts and noticed many useful snippets to share, let&rsquo;s start.
Where is Team Foundation Server installed? Scenario: your script runs TFSSecurity.exe; sadly this tool is not in the path and, worse, the path changes from one Team Foundation Server version to another.
The following function returns the Team Foundation Server path, e.g. C:\Program Files\Microsoft Team Foundation Server 12.0.
function Get-TeamFoundationServerInstallPath { if (Test-Path &#34;HKLM:\SOFTWARE\Microsoft\TeamFoundationServer&#34;) { $highestTFSversion = &#34;{0:N1}&#34; -f ( Get-ChildItem -Path &#34;HKLM:\SOFTWARE\Microsoft\TeamFoundationServer&#34; | Split-Path -Leaf | foreach { $_ -as [double] } | sort -Descending | select -First 1) $tfsPath = Get-ItemProperty -Path &#34;HKLM:\SOFTWARE\Microsoft\TeamFoundationServer\$highestTFSversion&#34; -Name InstallPath -ErrorAction SilentlyContinue if ($tfsPath) { $tfsPath."><meta itemprop=datePublished content="2014-09-19T17:07:59+00:00"><meta itemprop=dateModified content="2014-09-19T17:07:59+00:00"><meta itemprop=wordCount content="468"><meta itemprop=keywords content="TFS,Powershell,TFS Administration,"><meta property="og:title" content="TFS in PowerShell"><meta property="og:description" content="I am re-factoring my PowerShell administration scripts and noticed many useful snippets to share, let&rsquo;s start.
Where is Team Foundation Server installed? Scenario: your script runs TFSSecurity.exe; sadly this tool is not in the path and, worse, the path changes from one Team Foundation Server version to another.
The following function returns the Team Foundation Server path, e.g. C:\Program Files\Microsoft Team Foundation Server 12.0.
function Get-TeamFoundationServerInstallPath { if (Test-Path &#34;HKLM:\SOFTWARE\Microsoft\TeamFoundationServer&#34;) { $highestTFSversion = &#34;{0:N1}&#34; -f ( Get-ChildItem -Path &#34;HKLM:\SOFTWARE\Microsoft\TeamFoundationServer&#34; | Split-Path -Leaf | foreach { $_ -as [double] } | sort -Descending | select -First 1) $tfsPath = Get-ItemProperty -Path &#34;HKLM:\SOFTWARE\Microsoft\TeamFoundationServer\$highestTFSversion&#34; -Name InstallPath -ErrorAction SilentlyContinue if ($tfsPath) { $tfsPath."><meta property="og:type" content="article"><meta property="og:url" content="http://blog.casavian.eu/2014/09/19/tfs-in-powershell/"><meta property="article:published_time" content="2014-09-19T17:07:59+00:00"><meta property="article:modified_time" content="2014-09-19T17:07:59+00:00"><meta property="og:site_name" content="Giulio Vian's Blog!"><meta name=twitter:card content="summary"><meta name=twitter:title content="TFS in PowerShell"><meta name=twitter:description content="I am re-factoring my PowerShell administration scripts and noticed many useful snippets to share, let&rsquo;s start.
Where is Team Foundation Server installed? Scenario: your script runs TFSSecurity.exe; sadly this tool is not in the path and, worse, the path changes from one Team Foundation Server version to another.
The following function returns the Team Foundation Server path, e.g. C:\Program Files\Microsoft Team Foundation Server 12.0.
function Get-TeamFoundationServerInstallPath { if (Test-Path &#34;HKLM:\SOFTWARE\Microsoft\TeamFoundationServer&#34;) { $highestTFSversion = &#34;{0:N1}&#34; -f ( Get-ChildItem -Path &#34;HKLM:\SOFTWARE\Microsoft\TeamFoundationServer&#34; | Split-Path -Leaf | foreach { $_ -as [double] } | sort -Descending | select -First 1) $tfsPath = Get-ItemProperty -Path &#34;HKLM:\SOFTWARE\Microsoft\TeamFoundationServer\$highestTFSversion&#34; -Name InstallPath -ErrorAction SilentlyContinue if ($tfsPath) { $tfsPath."><meta name=twitter:site content="@giulio_vian"><link rel=alternate href=/index.xml type=application/rss+xml title="Giulio Vian's Blog!"><link rel=stylesheet href=/css/vendor.min.95b0b4c4607aec507f0fc9d9c36a12a4613ccac06f9423caa43e265cb58eb5f90709388cc0fa166ac3ca836b4163e6d0569b8b86065d9cabdf223c5ea9a63b08.css integrity="sha512-lbC0xGB67FB/D8nZw2oSpGE8ysBvlCPKpD4mXLWOtfkHCTiMwPoWasPKg2tBY+bQVpuLhgZdnKvfIjxeqaY7CA=="><link href=http://blog.casavian.eu/css/cookieconsent.min.cd0d0b6e50ff01ff2f3a9a70d7cfb66a7c6cb9acf7a566325568be6d3bd31fc4.css rel=stylesheet type=text/css integrity="sha256-zQ0LblD/Af8vOppw18+2anxsuaz3pWYyVWi+bTvTH8Q=" crossorigin=anonymous><script src=http://blog.casavian.eu/js/cookieconsent.min.e55842a856a6d829feca3c3ad736c136b6c7549e9247274f78aa296259e06e24.js integrity="sha256-5VhCqFam2Cn+yjw61zbBNrbHVJ6SRydPeKopYlngbiQ=" crossorigin=anonymous async></script><script>window.addEventListener("load",function(){window.cookieconsent.initialise({"palette":{"popup":{"background":"#428bca","text":"#ffffff"},"button":{"background":"#f71559"}},"content":{"message":'This website uses cookies.',"dismiss":'Got it!',"link":'Learn more.',"href":"http:\/\/blog.casavian.eu\/page\/privacy-cookies-policy\/"},"position":"bottom-right"})});</script><body><nav class="navbar navbar-light bg-white navbar-expand-lg border-bottom"><div class=container><a class="navbar-brand text-primary" href=/>Giulio Vian's Blog!</a>
<button class="navbar-toggler collapsed" type=button data-toggle=collapse data-target=#navbarCollapse aria-controls=navbarCollapse aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="navbar-collapse collapse" id=navbarCollapse><ul class="navbar-nav mr-auto"><li class=nav-item><a class="nav-link text-primary" href=/index.html><i class="fas fa-home"></i>Home</a></li><li class=nav-item><a class="nav-link text-primary" href=/page/about/><i class="fa fa-info-circle"></i>About</a></li><li class=nav-item><a class="nav-link text-primary" href=/page/public-speaking><i class="fa fa-microphone"></i>Speaking</a></li><li class=nav-item><a class="nav-link text-primary" href=/it><i class="fa fa-language"></i>Italian</a></li></ul></div></div></nav><main role=main><div class="container mt-3 mb-3"><div class=card><div class=card-body><h1 class=card-title><a href=/2014/09/19/tfs-in-powershell/>TFS in PowerShell</a></h1><h6 class="card-subtitle mb-2 text-muted"><i class="fas fa-calendar-day"></i>&nbsp;19 Sep 2014 -
<i class="fas fa-user"></i>&nbsp;Giulio Vian
- <i class="fas fa-clock"></i>&nbsp;~3 Minutes</h6><p class=card-text><p>I am re-factoring my PowerShell administration scripts and noticed many useful snippets to share, let&rsquo;s start.</p><h2 id=where-is-team-foundation-server-installed>Where is Team Foundation Server installed?</h2><p>Scenario: your script runs <code>TFSSecurity.exe</code>; sadly this tool is not in the path and, worse, the path changes from one Team Foundation Server version to another.</p><p>The following function returns the Team Foundation Server path, e.g. <code>C:\Program Files\Microsoft Team Foundation Server 12.0</code>.</p><pre><code class=language-PowerShell# data-lang=PowerShell#>function Get-TeamFoundationServerInstallPath
{
    if (Test-Path &quot;HKLM:\SOFTWARE\Microsoft\TeamFoundationServer&quot;) {
        $highestTFSversion = &quot;{0:N1}&quot; -f (
            Get-ChildItem -Path &quot;HKLM:\SOFTWARE\Microsoft\TeamFoundationServer&quot; |
                Split-Path -Leaf |
                foreach { $_ -as [double] } |
                sort -Descending |
                select -First 1)
        $tfsPath = Get-ItemProperty
                    -Path &quot;HKLM:\SOFTWARE\Microsoft\TeamFoundationServer\$highestTFSversion&quot;
                    -Name InstallPath
                    -ErrorAction SilentlyContinue
        if ($tfsPath) {
            $tfsPath.InstallPath
        }
    }#if
}
</code></pre><p>The path is searched in the registry.</p><p><figure class=image-caption><a href=/2014/09/19/tfs-in-powershell/2014-09-19_161032.png><img loading=lazy height=289 width=241 style=max-width:100%;height:auto srcset="/2014/09/19/tfs-in-powershell/2014-09-19_161032.png 500w," src=/2014/09/19/tfs-in-powershell/2014-09-19_161032.png alt="Registry section with TFS keys"></a><figcaption></figcaption></figure></p><p>and determines the most recent version of TFS installed, then the root installation path is found at the <code>InstallPath</code> property. It returns <code>$null</code> if anything goes wrong.</p><p>Concatenate the <code>Tools</code> directory and the tool you need and it is done.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-PowerShell data-lang=PowerShell>$TFSSecurity = Join-Path (Get-TeamFoundationServerInstallPath) -ChildPath <span style=color:#e6db74>&#39;Tools\TFSSecurity.exe&#39;</span>
</code></pre></div><h2 id=where-is-visual-studio-installed>Where is Visual Studio installed?</h2><p>The scenario is similar to the precedent: you want to run some tool like <code>witadmin.exe</code> from a script.</p><p>The following function returns the Visual Studio path, more precisely to a path like <code>C:\Program Files (x86)\Microsoft Visual Studio 12.0\Common7\IDE</code> where most binaries live.</p><pre><code class=language-PowerShell# data-lang=PowerShell#>function Get-VisualStudioInstallDir
{
    if ($env:ProgramW6432) {
        # 64 bit
        $registryBase = &quot;HKLM:\SOFTWARE\Wow6432Node\Microsoft&quot;
    } else {
        # 32 bit
        $registryBase = &quot;HKLM:\SOFTWARE\Microsoft&quot;
    }
    if (Test-Path &quot;$registryBase\VisualStudio&quot;) {
        $highestVSversion = &quot;{0:N1}&quot; -f (Get-ChildItem -Path &quot;$registryBase\VisualStudio&quot; | Split-Path -Leaf | foreach { $_ -as [double] } | sort -Descending | select -First 1)    
        $vsPath = Get-ItemProperty -Path &quot;$registryBase\VisualStudio\$highestVSversion&quot; -Name InstallDir -ErrorAction SilentlyContinue
        if ($vsPath) {
            $vsPath.InstallDir
        }
    }
}
</code></pre><p>As you may see, it is a bit more complex, as you have to account for 32 and 64 bit operating systems. Visual Studio is still a 32-bit application even when installed on a 64 bit operating system. This means that setup information is stored in the 32-bit hive of Windows Registry.
Apart from this the code is the same for TFS, only the registry path is different.</p><p>Using the result do not change either.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-PowerShell data-lang=PowerShell>$witadmin = Join-Path (Get-VisualStudioInstallDir) -ChildPath <span style=color:#e6db74>&#39;witadmin.exe&#39;</span>
</code></pre></div><h2 id=which-team-foundation-server-roles-are-configured>Which Team Foundation Server roles are configured?</h2><p>This snippet is a variation on the first. It searches what has been configured using the Administration Console.</p><pre><code class=language-PowerShell# data-lang=PowerShell#>function Get-TeamFoundationServerInstalledComponents
{
    if (Test-Path &quot;HKLM:\SOFTWARE\Microsoft\TeamFoundationServer&quot;) {
        $highestTFSversion = &quot;{0:N1}&quot; -f (Get-ChildItem -Path &quot;HKLM:\SOFTWARE\Microsoft\TeamFoundationServer&quot; | Split-Path -Leaf | foreach { $_ -as [double] } | sort -Descending | select -First 1)
      Get-ChildItem -Path &quot;HKLM:\SOFTWARE\Microsoft\TeamFoundationServer\$highestTFSversion\InstalledComponents&quot; -ErrorAction SilentlyContinue | where {
          (Get-ItemProperty -Path $_.PSPath -Name IsConfigured -ErrorAction SilentlyContinue).IsConfigured -eq 1
      } | foreach {
          Split-Path -Path $_.PSPath -Leaf
      }#for
    }#if
}
</code></pre><p>The output is a sequence of values, e.g.</p><pre><code>ApplicationTier
TeamBuild
</code></pre><p>other possible values are</p><pre><code>SharePointExtensions
VersionControlProxy
</code></pre><p>You can download the Powershell Module from <a href=TfsLibrary.zip>here
</a>.</p></p></div><div class=card-footer><small class=text-muted><i class="fas fa-folder text-primary"></i>&nbsp;
<a href=/categories/#alm class="badge badge-primary"><span>ALM</span></a><br><i class="fas fa-tags text-secondary"></i>&nbsp;
<a href=/tags/#tfs class="badge badge-secondary"><span>TFS</span></a>
<a href=/tags/#powershell class="badge badge-secondary"><span>Powershell</span></a>
<a href=/tags/#tfs-administration class="badge badge-secondary"><span>TFS Administration</span></a></small></div></div><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"blog-casavian"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></main><footer class="navbar-light border-top"><div class=container><div class=row><div class="col-12 col-md-3 mb-3"><h5>Giulio Vian's Blog!</h5>Notes and considerations of small venetian guy on DevOps tools, architecture, development and other paraphernalia.</div><div class="col-12 col-md-3 mb-3"><h5>Social</h5><ul class="list-unstyled list-inline"><li class=list-inline-item><a href=https://github.com/giuliov target=_blank rel="noopener noreferrer" title=GitHub class="fab fa-github fa-2x"></a></li><li class=list-inline-item><a href=https://stackoverflow.com/users/100864 target=_blank rel="noopener noreferrer" title="Stack Overflow" class="fab fa-stack-overflow fa-2x"></a></li><li class=list-inline-item><a href=https://medium.com/@giuliovdev target=_blank rel="noopener noreferrer" title=Medium class="fab fa-medium fa-2x"></a></li><li class=list-inline-item><a href=https://linkedin.com/in/giuliovian target=_blank rel="noopener noreferrer" title=LinkedIn class="fab fa-linkedin fa-2x"></a></li><li class=list-inline-item><a href=https://linkedin.com/company/unum-ireland-ltd-it target=_blank rel="noopener noreferrer" title="LinkedIn Company" class="fab fa-linkedin fa-2x"></a></li><li class=list-inline-item><a href=https://xing.com/profile/Giulio_Vian target=_blank rel="noopener noreferrer" title=Xing class="fab fa-xing fa-2x"></a></li><li class=list-inline-item><a href=https://slideshare.net/giuliov target=_blank rel="noopener noreferrer" title=SlideShare class="fab fa-slideshare fa-2x"></a></li><li class=list-inline-item><a href=https://youtube.com/UCZ-J6JRyvz6aaJ9zCN5wpxA target=_blank rel="noopener noreferrer" title=YouTube class="fab fa-youtube fa-2x"></a></li><li class=list-inline-item><a href=https://twitter.com/giulio_vian target=_blank rel="noopener noreferrer" title=Twitter class="fab fa-twitter fa-2x"></a></li><li class=list-inline-item><a href=mailto:giulio.dev@casavian.eu title=Email class="fas fa-envelope fa-2x"></a></li></ul></div><div class="col-12 col-md-3 mb-3"><h5>Site</h5><ul class=list-unstyled><li><a href=/about/><i class="fas fa-address-card"></i>About</a></li><li><a href=/categories/><i class="fas fa-folder"></i>Categories</a></li><li><a href=/series/><i class="fas fa-book"></i>Series</a></li><li><a href=/tags/><i class="fas fa-tags"></i>Tags</a></li><li><a href=http://www.getlatestversion.eu/>Get Latest Version</a></li><li><a href=https://blogs.msdn.microsoft.com/giuliov/>Old blog</a></li></ul></div><div class="col-12 col-md-3 mb-3">&copy; 2020 Giulio Vian<br>Theme by <a href=https://www.spech.de target=_blank rel="noopener noreferrer">Sebastian Pech</a>.</div></div></div></footer><script src=/js/vendor.min.0497fa926ed3dc2241b91e016467480841da9749a0f7c40ed3960c3c238745e5accb5ec5e07654668e11047bbf96f95083b88dd49a845781011aba42e4f00a5d.js integrity="sha512-BJf6km7T3CJBuR4BZGdICEHal0mg98QO05YMPCOHReWsy17F4HZUZo4RBHu/lvlQg7iN1JqEV4EBGrpC5PAKXQ=="></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-46796059-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>