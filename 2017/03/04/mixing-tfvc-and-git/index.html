<!doctype html><html lang=en><meta charset=utf-8><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/blog.casavian.eu\/"},"articleSection":"post","name":"Mixing TFVC and Git","headline":"Mixing TFVC and Git","description":"Notes and considerations of small venetian guy on DevOps tools, architecture, development and other paraphernalia.","inLanguage":"en","author":"Giulio Vian","creator":"Giulio Vian","publisher":"Giulio Vian","accountablePerson":"Giulio Vian","copyrightHolder":"Giulio Vian","copyrightYear":"2017","datePublished":"2017-03-04T00:00:00Z","dateModified":"2017-03-04T00:00:00Z","url":"\/2017\/03\/04\/mixing-tfvc-and-git\/","wordCount":"579","keywords":["ALM","Git","TFVC","Build","TeamBuild","TFS Aggregator","TFS","VSTS","Blog"]}</script><title>Mixing TFVC and Git &ndash; Giulio Vian's Blog!</title><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=description content="Notes and considerations of small venetian guy on DevOps tools, architecture, development and other paraphernalia."><meta name=author content="Giulio Vian"><link rel=icon href=/favicon.ico><meta itemprop=name content="Mixing TFVC and Git"><meta itemprop=description content="It all started because I needed using files coming from a Git repository and additional files stored in classic Team Foundation Version Control (TFVC), all toghether in the same build.
The Options You have three options: the REST API, the tf.exe vc command or &mldr; we will see.
Option 1 – REST API My first attempt relied on a Powershell script to download the files from TFVC using REST API. It worked but performance is not that great as you have to download a file at a time in a loop."><meta itemprop=datePublished content="2017-03-04T00:00:00+00:00"><meta itemprop=dateModified content="2017-03-04T00:00:00+00:00"><meta itemprop=wordCount content="579"><meta itemprop=image content="http://blog.casavian.eu/2017/03/04/mixing-tfvc-and-git/feature-oil-in-water-1438445_1280.jpg"><meta itemprop=keywords content="ALM,Git,TFVC,Build,TeamBuild,TFS Aggregator,TFS,VSTS,"><meta property="og:title" content="Mixing TFVC and Git"><meta property="og:description" content="It all started because I needed using files coming from a Git repository and additional files stored in classic Team Foundation Version Control (TFVC), all toghether in the same build.
The Options You have three options: the REST API, the tf.exe vc command or &mldr; we will see.
Option 1 – REST API My first attempt relied on a Powershell script to download the files from TFVC using REST API. It worked but performance is not that great as you have to download a file at a time in a loop."><meta property="og:type" content="article"><meta property="og:url" content="http://blog.casavian.eu/2017/03/04/mixing-tfvc-and-git/"><meta property="og:image" content="http://blog.casavian.eu/2017/03/04/mixing-tfvc-and-git/feature-oil-in-water-1438445_1280.jpg"><meta property="article:published_time" content="2017-03-04T00:00:00+00:00"><meta property="article:modified_time" content="2017-03-04T00:00:00+00:00"><meta property="og:site_name" content="Giulio Vian's Blog!"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://blog.casavian.eu/2017/03/04/mixing-tfvc-and-git/feature-oil-in-water-1438445_1280.jpg"><meta name=twitter:title content="Mixing TFVC and Git"><meta name=twitter:description content="It all started because I needed using files coming from a Git repository and additional files stored in classic Team Foundation Version Control (TFVC), all toghether in the same build.
The Options You have three options: the REST API, the tf.exe vc command or &mldr; we will see.
Option 1 – REST API My first attempt relied on a Powershell script to download the files from TFVC using REST API. It worked but performance is not that great as you have to download a file at a time in a loop."><meta name=twitter:site content="@giulio_vian"><link rel=alternate href=/index.xml type=application/rss+xml title="Giulio Vian's Blog!"><link rel=stylesheet href=/css/vendor.min.95b0b4c4607aec507f0fc9d9c36a12a4613ccac06f9423caa43e265cb58eb5f90709388cc0fa166ac3ca836b4163e6d0569b8b86065d9cabdf223c5ea9a63b08.css integrity="sha512-lbC0xGB67FB/D8nZw2oSpGE8ysBvlCPKpD4mXLWOtfkHCTiMwPoWasPKg2tBY+bQVpuLhgZdnKvfIjxeqaY7CA=="><link href=http://blog.casavian.eu/css/cookieconsent.min.cd0d0b6e50ff01ff2f3a9a70d7cfb66a7c6cb9acf7a566325568be6d3bd31fc4.css rel=stylesheet type=text/css integrity="sha256-zQ0LblD/Af8vOppw18+2anxsuaz3pWYyVWi+bTvTH8Q=" crossorigin=anonymous><script src=http://blog.casavian.eu/js/cookieconsent.min.e55842a856a6d829feca3c3ad736c136b6c7549e9247274f78aa296259e06e24.js integrity="sha256-5VhCqFam2Cn+yjw61zbBNrbHVJ6SRydPeKopYlngbiQ=" crossorigin=anonymous async></script><script>window.addEventListener("load",function(){window.cookieconsent.initialise({"palette":{"popup":{"background":"#428bca","text":"#ffffff"},"button":{"background":"#f71559"}},"content":{"message":'This website uses cookies.',"dismiss":'Got it!',"link":'Learn more.',"href":"http:\/\/blog.casavian.eu\/page\/privacy-cookies-policy\/"},"position":"bottom-right"})});</script><body><nav class="navbar navbar-light bg-white navbar-expand-lg border-bottom"><div class=container><a class="navbar-brand text-primary" href=/>Giulio Vian's Blog!</a>
<button class="navbar-toggler collapsed" type=button data-toggle=collapse data-target=#navbarCollapse aria-controls=navbarCollapse aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="navbar-collapse collapse" id=navbarCollapse><ul class="navbar-nav mr-auto"><li class=nav-item><a class="nav-link text-primary" href=/index.html><i class="fas fa-home"></i>Home</a></li><li class=nav-item><a class="nav-link text-primary" href=/page/about/><i class="fa fa-info-circle"></i>About</a></li><li class=nav-item><a class="nav-link text-primary" href=/page/public-speaking><i class="fa fa-microphone"></i>Speaking</a></li><li class=nav-item><a class="nav-link text-primary" href=/it><i class="fa fa-language"></i>Italian</a></li></ul></div></div></nav><main role=main><div class="container mt-3 mb-3"><div class=card><img class=card-img-top src=/2017/03/04/mixing-tfvc-and-git/feature-oil-in-water-1438445_1280_hu802b957e3df300fe0706b2e41b1d077f_117304_1108x0_resize_q75_box.jpg alt="Mixing TFVC and Git" title="Mixing TFVC and Git"><div class=card-body><h1 class=card-title><a href=/2017/03/04/mixing-tfvc-and-git/>Mixing TFVC and Git</a></h1><h6 class="card-subtitle mb-2 text-muted"><i class="fas fa-calendar-day"></i>&nbsp;04 Mar 2017 -
<i class="fas fa-user"></i>&nbsp;Giulio Vian
- <i class="fas fa-clock"></i>&nbsp;~3 Minutes</h6><p class=card-text><p>It all started because I needed using files coming from a Git repository and additional files stored in classic Team Foundation Version Control (TFVC), all toghether in the same build.</p><h2 id=the-options>The Options</h2><p>You have three options: the REST API, the <code>tf.exe vc</code> command or &mldr; we will see.</p><h2 id=option-1-ndash-rest-api>Option 1 – REST API</h2><p>My first attempt relied on a Powershell script to download the files from TFVC using REST API.
It worked but performance is not that great as you have to download a file at a time in a loop.</p><p>Here is some sample code for it</p><pre><code>$tempFile = &quot;$env:BUILD_SOURCESDIRECTORY\all.json&quot;
$authHeader = @{ Authorization=( &quot;Basic {0}&quot; -f [Convert]::ToBase64String([Text.Encoding]::UTF8.GetBytes(&quot;:${env:PAT}&quot;)) ) }

Invoke-RestMethod -Uri &quot;${env:TfsProjectUrl}/_apis/tfvc/items?scopePath=${env:TfvcPath}&amp;recursionLevel=Full&amp;api-version=1.0&quot; -headers $authHeader -Method Get -OutFile $tempFile

$headers = $authHeader + @{ Accept= 'application/octet-stream' }
$baseTfvcPath = Split-Path $tfvcPath -Leaf
(Get-Content $tempFile | ConvertFrom-Json).value | foreach {
    $f = $_.path.Replace( $tfvcPath + '/', '' )
    if ($_.isFolder) {
        New-Item (Join-Path $baseTfvcPath -ChildPath $f) -Force -ItemType Directory &gt;$null
    } else {
        Write-Host &quot;Downloading ${f}&quot;
        Invoke-RestMethod -Uri $_.url -headers $headers -Method Get -OutFile $baseTfvcPath/$f
    }
}
</code></pre><p>The script uses three variables specifing the connection and authentication data in the form of a Personal Access Token (PAT).</p><table><thead><tr><th>Variable</th><th>Sample value</th></tr></thead><tbody><tr><td>TfsProjectUrl</td><td><a href=https://tfsaggregator.visualstudio.com/ProjectName>https://tfsaggregator.visualstudio.com/ProjectName</a></td></tr><tr><td>TfvcPath</td><td>$/ProjectName/References</td></tr><tr><td>PAT</td><td>3wvu&mldr;.sk7a</td></tr></tbody></table><h2 id=option-2-ndash-tf-vc>Option 2 – <code>tf vc</code></h2><p>A second option would be to use <code>tf.exe</code>. In order to do so, you need to define a workspace including the mapping: a very boring and detailed process with no less that the following four commands.</p><pre><code>tf vc workspace /new 
tf vc workfold
tf vc get $/YourProject
tf vc workspace /delete
</code></pre><p>Using this approach is not something I would recommend lightly, in particoular handling errors correctly is non trivial. Furthermore, you have to put authentication data in variables.</p><h2 id=option-3-ndash-chain-two-build>Option 3 – Chain two build!</h2><p>But wait, both Visual Studio Team Services (VSTS) and Team Foundation Server (TFS) can use TFVC as a version control source, so why not simply add all downloaded files as resulting build artifacts? The build using Git picks the artifacts from another build using TFVC.</p><p>Let&rsquo;s see how it works in details.</p><h3 id=tfvc-dummy-build-upstream-producer>TFVC dummy build (Upstream Producer)</h3><p>Get the files from TFVC</p><p><img src=/post/2017-03-mixing-tfvc-and-git/pub-1.png alt="Get from TFVC"></p><p>and publish them all as artifacts</p><p><img src=/post/2017-03-mixing-tfvc-and-git/pub-2.png alt="Publish Artifacts"></p><p>I activated the new Build Editor, so if you are still using the old editor, the screenshots will look different.</p><h3 id=git-build-downstream-consumer>Git Build (Downstream Consumer)</h3><p>First you need to search the Marketplace for <strong>Fetch Build Artifacts</strong> Extension</p><p><img src=/post/2017-03-mixing-tfvc-and-git/extension-in-marketplace.png alt="&amp;lsquo;Fetch Build Artifacts&amp;rsquo; Extension in Marketplace"></p><p>and install it onto your system</p><p><img src=/post/2017-03-mixing-tfvc-and-git/extension-installed.png alt="Extension Installed"></p><p>Add the extension Task to your Build Definition</p><p><img src=/post/2017-03-mixing-tfvc-and-git/use-1.png alt="Fetch Build Artifacts Task"></p><p>The <strong>Build Definition Id</strong> can be found in the <em>Process Variables</em> of the TFVC dummy build</p><p><img src=/post/2017-03-mixing-tfvc-and-git/Build-Definition-Id.png alt="Process Variables of TFVC dummy build"></p><p>Note: the Extension requires access to the OAuth token as shown in the below screenshot.</p><p><img src=/post/2017-03-mixing-tfvc-and-git/OAuth-token.png alt="Access to OAuth token"></p><h2 id=pros--cons>Pros & Cons</h2><p>Some side benefits:</p><ol><li>The scenario went down from three minutes to less than 30 seconds compared to the REST APIs;</li><li>You need one less Task and three less Variables;</li><li>You don&rsquo;t need to manage a PAT</li></ol><p>On the other hand, the downstream Git build is using a snapshot defined by the upstream TFVC which can be a good or a bad thing.</p><p>The build chaining fits quite well my scenario, where I need some additional references and I could not stored them in the Git repository. Also, the DLLs are quite static and do not change much.</p><p>Do not forget to mark the upstream build as retained if you need to keep a specific version around.</p><p><img src=/post/2017-03-mixing-tfvc-and-git/retain.png alt></p><p>This technique is in use at our open source project <a href=https://tfsaggregator.github.io/ target=_blank rel="noopener noreferrer">TFS Aggregator
&nbsp;<i class="fas fa-external-link-alt"></i>
</a>.</p><p>Happy Building!</p></p></div><div class=card-footer><small class=text-muted><i class="fas fa-folder text-primary"></i>&nbsp;
<a href=/categories/#alm class="badge badge-primary"><span>ALM</span></a><br><i class="fas fa-tags text-secondary"></i>&nbsp;
<a href=/tags/#alm class="badge badge-secondary"><span>ALM</span></a>
<a href=/tags/#git class="badge badge-secondary"><span>Git</span></a>
<a href=/tags/#tfvc class="badge badge-secondary"><span>TFVC</span></a>
<a href=/tags/#build class="badge badge-secondary"><span>Build</span></a>
<a href=/tags/#teambuild class="badge badge-secondary"><span>TeamBuild</span></a>
<a href=/tags/#tfs-aggregator class="badge badge-secondary"><span>TFS Aggregator</span></a>
<a href=/tags/#tfs class="badge badge-secondary"><span>TFS</span></a>
<a href=/tags/#vsts class="badge badge-secondary"><span>VSTS</span></a></small></div></div></div></main><footer class="navbar-light border-top"><div class=container><div class=row><div class="col-12 col-md-3 mb-3"><h5>Giulio Vian's Blog!</h5>Notes and considerations of small venetian guy on DevOps tools, architecture, development and other paraphernalia.</div><div class="col-12 col-md-3 mb-3"><h5>Social</h5><ul class="list-unstyled list-inline"><li class=list-inline-item><a href=https://github.com/giuliov target=_blank rel="noopener noreferrer" title=GitHub class="fab fa-github fa-2x"></a></li><li class=list-inline-item><a href=https://stackoverflow.com/users/100864 target=_blank rel="noopener noreferrer" title="Stack Overflow" class="fab fa-stack-overflow fa-2x"></a></li><li class=list-inline-item><a href=https://medium.com/@giuliovdev target=_blank rel="noopener noreferrer" title=Medium class="fab fa-medium fa-2x"></a></li><li class=list-inline-item><a href=https://linkedin.com/in/giuliovian target=_blank rel="noopener noreferrer" title=LinkedIn class="fab fa-linkedin fa-2x"></a></li><li class=list-inline-item><a href=https://linkedin.com/company/unum-ireland-ltd-it target=_blank rel="noopener noreferrer" title="LinkedIn Company" class="fab fa-linkedin fa-2x"></a></li><li class=list-inline-item><a href=https://xing.com/profile/Giulio_Vian target=_blank rel="noopener noreferrer" title=Xing class="fab fa-xing fa-2x"></a></li><li class=list-inline-item><a href=https://slideshare.net/giuliov target=_blank rel="noopener noreferrer" title=SlideShare class="fab fa-slideshare fa-2x"></a></li><li class=list-inline-item><a href=https://youtube.com/UCZ-J6JRyvz6aaJ9zCN5wpxA target=_blank rel="noopener noreferrer" title=YouTube class="fab fa-youtube fa-2x"></a></li><li class=list-inline-item><a href=https://twitter.com/giulio_vian target=_blank rel="noopener noreferrer" title=Twitter class="fab fa-twitter fa-2x"></a></li><li class=list-inline-item><a href=mailto:giulio.dev@casavian.eu title=Email class="fas fa-envelope fa-2x"></a></li></ul></div><div class="col-12 col-md-3 mb-3"><h5>Site</h5><ul class=list-unstyled><li><a href=/about/><i class="fas fa-address-card"></i>About</a></li><li><a href=/categories/><i class="fas fa-folder"></i>Categories</a></li><li><a href=/series/><i class="fas fa-book"></i>Series</a></li><li><a href=/tags/><i class="fas fa-tags"></i>Tags</a></li><li><a href=http://www.getlatestversion.eu/>Get Latest Version</a></li><li><a href=https://blogs.msdn.microsoft.com/giuliov/>Old blog</a></li></ul></div><div class="col-12 col-md-3 mb-3">&copy; 2020 Giulio Vian<br>Theme by <a href=https://www.spech.de target=_blank rel="noopener noreferrer">Sebastian Pech</a>.</div></div></div></footer><script src=/js/vendor.min.0497fa926ed3dc2241b91e016467480841da9749a0f7c40ed3960c3c238745e5accb5ec5e07654668e11047bbf96f95083b88dd49a845781011aba42e4f00a5d.js integrity="sha512-BJf6km7T3CJBuR4BZGdICEHal0mg98QO05YMPCOHReWsy17F4HZUZo4RBHu/lvlQg7iN1JqEV4EBGrpC5PAKXQ=="></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-46796059-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>